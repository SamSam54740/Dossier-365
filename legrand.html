<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mission 06 : CLEAN</title>
    <style>
        :root {
            --bg-app: #2c3e50;
            --hole-bg: #34495e;
            --primary: #e74c3c;
            --text: white;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-app);
            color: var(--text);
            margin: 0; height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            touch-action: none; overflow: hidden;
            user-select: none;
        }

        body {
            /* Change justify-content: center par flex-start */
            justify-content: flex-start; 
            padding-top: 5vh; /* Pousse un peu vers le bas mais reste haut */
            /* ... garde le reste (font-family, colors...) */
        }

        /* 2. STYLE DU TIMER (Ajouter) */
        #timer-display {
            font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;
            background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 15px;
            color: inherit; /* S'adapte au th√®me */
            border: 1px solid currentColor;
        }

        /* 3. ECRAN DE FIN PERSONNALIS√â (Modifier #win-modal .code-box) */
        .code-box {
            background: #fff; border: 2px dashed currentColor; /* Cadre pointill√© joli */
            padding: 20px; font-size: 2rem; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: rotate(-2deg); /* Petit effet style sticker */
            margin: 30px 0;
        }
        #win-modal h2 { text-transform: uppercase; letter-spacing: 2px; }

        h1 { margin: 0; font-size: 1.5rem; color: #f1c40f; text-transform: uppercase; }
        p { color: #bdc3c7; font-size: 0.9rem; margin-bottom: 20px; text-align: center; max-width: 300px; }
        p { color: #ffffff; font-size: 0.9rem; margin-bottom: 20px; text-align: center; max-width: 300px; }

        .score-board {
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex; gap: 20px;
        }
        .timer { color: #e74c3c; }

        /* LA GRILLE DE JEU */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 90vw; max-width: 350px; aspect-ratio: 1/1;
        }

        .hole {
            background-color: var(--hole-bg);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border-bottom: 5px solid rgba(0,0,0,0.5);
            cursor: pointer;
            /* Pour l'effet d'enfoncement */
            transition: transform 0.1s;
        }
        .hole:active { transform: translateY(2px); border-bottom-width: 2px; }

        /* LES PERSOS */
        .mole {
            position: absolute;
            top: 100%; /* Cach√© en bas */
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
            transition: top 0.1s ease-out;
            pointer-events: none; /* Le clic se fait sur le hole */
        }

        /* Quand il sort */
        .hole.up .mole { top: 0; }

        /* Feedback visuel */
        .hole.bonk { background-color: #f1c40f; } /* Jaune si touch√© */
        .hole.miss { background-color: #c0392b; } /* Rouge si erreur (touch√© une bi√®re) */

        /* BOUTON START */
        button.start-btn {
            margin-top: 30px; padding: 15px 40px;
            font-size: 1.2rem; font-weight: bold;
            background: #27ae60; color: white; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 0 #1e8449;
            transition: all 0.1s;
        }
        button.start-btn:active { transform: translateY(5px); box-shadow: none; }

        /* MODALE VICTOIRE */
        #win-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; flex-direction: column; color: white; text-align: center; z-index: 100; animation: fadeIn 0.5s; }
        .code-box { background: white; color: #333; padding: 15px 30px; margin: 20px; font-family: monospace; font-size: 1.5rem; letter-spacing: 2px; font-weight: bold; border-radius: 10px; }
        button.reset { margin-top: 25px; padding: 10px 20px; background: #333; border: 1px solid #555; border-radius: 20px; color: white; font-weight: bold; cursor: pointer; }

        /* Ajoute un style pour l'√©chec */
        #fail-modal {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(50, 0, 0, 0.95); /* Fond rouge sombre */
            align-items: center; justify-content: center; flex-direction: column;
            color: white; text-align: center; z-index: 100;
        }

        #win-modal, #fail-modal {
            padding-bottom: 20vh; 
            box-sizing: border-box;
        }

    </style>
</head>
<body>

    <h1>MISSION CLEAN</h1>
    <p>Tape sur les gal√®res (ü•¶, üåßÔ∏è, ‚úàÔ∏è).<br>Ne renverse PAS les bi√®res (üç∫) !</p>

    <div class="score-board">
        <span>Score: <span id="score">0</span></span>
        <span class="timer">‚è≥ <span id="time-left">30</span></span>
    </div>

    <div class="game-grid">
        <div class="hole" id="hole1"><div class="mole"></div></div>
        <div class="hole" id="hole2"><div class="mole"></div></div>
        <div class="hole" id="hole3"><div class="mole"></div></div>
        <div class="hole" id="hole4"><div class="mole"></div></div>
        <div class="hole" id="hole5"><div class="mole"></div></div>
        <div class="hole" id="hole6"><div class="mole"></div></div>
        <div class="hole" id="hole7"><div class="mole"></div></div>
        <div class="hole" id="hole8"><div class="mole"></div></div>
        <div class="hole" id="hole9"><div class="mole"></div></div>
    </div>

    <button class="start-btn" onclick="startGame()">JOUER !</button>

    <div id="win-modal">
        <div style="font-size: 4rem;">üßπ</div>
        <h2>SYST√àME PROPRE !</h2>
        <p>Les bugs sont √©limin√©s. Bravo mon chat !</p>
        <div class="code-box">FINAL-123</div>
        <a href="index.html" style="color: white; font-weight: bold; text-decoration: none; border-bottom: 1px solid white;">Retour au QG</a>
    </div>

    <div id="fail-modal">
        <div style="font-size: 4rem;">üíÄ</div>
        <h2>√âCHEC CRITIQUE</h2>
        <p>Trop de bugs sont pass√©s...</p>
        <p>Score requis : 20</p>
        <button class="start-btn" onclick="location.reload()" style="background: white; color: #c0392b; margin-top:20px;">R√âESSAYER</button>
    </div>

    <script>
        // CONFIGURATION DROLES
        const badItems = ['ü•¶', 'üåßÔ∏è', '‚úàÔ∏è', '‚è∞', 'üìâ', 'ü¶ü']; // √áa rapporte des points
        const goodItems = ['üç∫', '‚ù§Ô∏è', 'ü•©', 'üç∫']; // √áa enl√®ve des points (pi√®ges !), j'ai mis 2 fois bi√®re pour qu'elle sorte souvent

        const holes = document.querySelectorAll('.hole');
        const scoreBoard = document.getElementById('score');
        const timeLeftBoard = document.getElementById('time-left');
        const moles = document.querySelectorAll('.mole');
        
        let lastHole;
        let timeUp = false;
        let score = 0;
        let timeLeft = 30;
        let gameTimer;
        let peepTimer;
        let isPlaying = false;

        // Choisi un trou au hasard
        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return hole;
        }

        // Choisi un temps d'apparition (vitesse)
        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        // Fait apparaitre un truc
        function peep() {
            const time = randomTime(500, 1000); // Vitesse
            const hole = randomHole(holes);
            const mole = hole.querySelector('.mole');
            
            // D√©cider si c'est un ami ou un ennemi
            // 30% de chance d'√™tre une bi√®re (Pi√®ge)
            const isTrap = Math.random() > 0.7; 
            
            if (isTrap) {
                mole.innerText = goodItems[Math.floor(Math.random() * goodItems.length)];
                hole.dataset.type = 'good';
            } else {
                mole.innerText = badItems[Math.floor(Math.random() * badItems.length)];
                hole.dataset.type = 'bad';
            }

            hole.classList.add('up');

            setTimeout(() => {
                hole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function startGame() {
            if(isPlaying) return;
            isPlaying = true;
            scoreBoard.textContent = 0;
            timeUp = false;
            score = 0;
            timeLeft = 30;
            timeLeftBoard.textContent = timeLeft;
            document.querySelector('.start-btn').style.display = 'none'; // Cache le bouton

            peep(); // Commence √† faire sortir les taupes

            // Compte √† rebours
            gameTimer = setInterval(() => {
                timeLeft--;
                timeLeftBoard.textContent = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(gameTimer);
                    timeUp = true;
                    isPlaying = false;
                    endGame();
                }
            }, 1000);
        }

        function bonk(e) {
            if(!e.isTrusted) return; // Anti-cheat basique
            if(!this.classList.contains('up')) return; // Si pas sorti

            const type = this.dataset.type;
            
            if (type === 'bad') {
                // BRAVO
                score++;
                this.classList.remove('up');
                this.classList.add('bonk'); // Flash jaune
                setTimeout(() => this.classList.remove('bonk'), 200);
            } else {
                // A√èE (On a tap√© une bi√®re)
                score = Math.max(0, score - 3); // P√©nalit√©
                this.classList.remove('up');
                this.classList.add('miss'); // Flash rouge
                setTimeout(() => this.classList.remove('miss'), 200);
                
                // Petit effet tremblement √©cran
                document.body.style.transform = "translateX(5px)";
                setTimeout(() => document.body.style.transform = "translateX(0)", 100);
            }
            
            scoreBoard.textContent = score;
        }

        // Modifier endGame()
        function endGame() {
            
            // NOUVEAU SCORE CIBLE : 20
            if(score >= 20) {
                document.getElementById('win-modal').style.display = 'flex';
            } else {
                // Affiche le nouvel √©cran d'√©chec
                document.getElementById('fail-modal').style.display = 'flex';
            }
        }

        holes.forEach(hole => hole.addEventListener('mousedown', bonk));
        holes.forEach(hole => hole.addEventListener('touchstart', bonk)); // Mobile support

    </script>
</body>
</html>